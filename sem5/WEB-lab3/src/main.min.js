"use strict";function login(o,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;$.post("/login",{username:o,password:n}).done(function(o){t&&t(o)}).fail(function(o){e&&e(o.responseText)})}function signin(o,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;$.post("/user",{username:o,password:n}).done(function(o){t&&t(o)}).fail(function(o){e&&e(o.responseText)})}function logout(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;$.ajax({url:"/login",type:"DELETE"}).done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function signout(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;$.ajax({url:"/user",type:"DELETE"}).done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function part_user(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;$.post("/users",{part:o,username:n}).done(function(o){t&&t(o)}).fail(function(o){e&&e(o.responseText)})}function money_user(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;$.post("/users",{money:o,username:n}).done(function(o){t&&t(o)}).fail(function(o){e&&e(o.responseText)})}function add_book(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;$.ajax({url:"/books",type:"PUT",data:"book="+JSON.stringify(o)}).done(function(o){n&&n(o?JSON.parse(o):"")}).fail(function(o){t&&t(o.responseText)})}function edit_book(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;$.post("/books",{book:JSON.stringify(o)}).done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function remove_book(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;$.ajax({url:"/books",type:"DELETE",data:"code="+o}).done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function return_book(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;$.ajax({url:"/part",type:"PUT",data:"give-book="+o}).done(function(o){n&&n(o?JSON.parse(o):"")}).fail(function(o){t&&t(o.responseText)})}function take_book(o,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0,e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;$.ajax({url:"/part",type:"PUT",data:"take-book="+o+"&params="+JSON.stringify(n)}).done(function(o){t&&t(o?JSON.parse(o):"")}).fail(function(o){e&&e(o.responseText)})}function assemble_participation(o,n,t){return o<n&&{min_step:o,max_step:n,start_cost:t}}function assemble_book(o,n,t,e,i,a,r){var s={name:o,cover:"./covers/default.jpg",code:void 0,author:n,publication:t,description:e||"[Нет описания]",part:a};i&&"string"!=typeof i?((a=new FormData).append("image",i),$.ajax({url:"/cover",type:"POST",data:a,processData:!1,contentType:!1}).done(function(o){s.cover=o,r(s)}).fail(function(){console.log("Cover can not be uploaded!"),r(s)})):(i&&"string"==typeof i&&(s.cover=i),r(s))}function _createForOfIteratorHelper(o,n){var t;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(t=_unsupportedIterableToArray(o))||n&&o&&"number"==typeof o.length){t&&(o=t);var e=0,n=function(){};return{s:n,n:function(){return e>=o.length?{done:!0}:{done:!1,value:o[e++]}},e:function(o){throw o},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,r=!1;return{s:function(){t=o[Symbol.iterator]()},n:function(){var o=t.next();return a=o.done,o},e:function(o){r=!0,i=o},f:function(){try{a||null==t.return||t.return()}finally{if(r)throw i}}}}function _unsupportedIterableToArray(o,n){if(o){if("string"==typeof o)return _arrayLikeToArray(o,n);var t=Object.prototype.toString.call(o).slice(8,-1);return"Object"===t&&o.constructor&&(t=o.constructor.name),"Map"===t||"Set"===t?Array.from(o):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(o,n):void 0}}function _arrayLikeToArray(o,n){(null==n||n>o.length)&&(n=o.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=o[t];return e}function get_params(o){return new URLSearchParams(window.location.search).get(o)}function collect_values_if_possible(){for(var o=arguments.length,n=new Array(o),t=0;t<o;t++)n[t]=arguments[t];var e=[].concat(n),e=$(e.map(function(o){return"#"+o}).join(", ")),i=!0;if(e.map(function(){return $(this).toggleClass("is-invalid",""===this.value),i&=""!==this.value,this}),i){var a=Object(),r=_createForOfIteratorHelper(e);try{for(r.s();!(s=r.n()).done;){var s=s.value;a[s.id]=s.value}}catch(o){r.e(o)}finally{r.f()}return a}}function push_books(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;$.post("/lib").done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function pull_books(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0;$.get("/lib").done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function set_settings(o){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;$.post("/settings",{settings:o}).done(function(o){n&&n(o)}).fail(function(o){t&&t(o.responseText)})}function on_back(){window.location="/"}function on_return(){return_book(get_params("code"),function(){window.location=window.location.href})}function on_delete(){remove_book(get_params("code"),function(){window.location="/"})}function toggle_part(){$("#part_container :input").prop("disabled",!$("#part_input").prop("checked"))}function save_book_data(o){var n=collect_values_if_possible("book_name","book_author","book_date"),t=!1;if($("#part_input").prop("checked")){var e=collect_values_if_possible("min_step","max_step","start_cost");if(!(t=assemble_participation(e.min_step,e.max_step,e.start_cost)))return void alert("Min step should be less than max!")}e=$("#book_cover");n?assemble_book(n.book_name,n.book_author,n.book_date,$("#book_description").val(),e.prop("files")&&0<e.prop("files").length?e.prop("files")[0]:e.attr("val"),t,o):console.log("Params not collected!")}function on_modal_book_save(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=!isNaN(n);save_book_data(function(o){o&&(t&&(o.code=n),(t?edit_book:add_book)(o,function(){window.location=window.location.href}))})}function on_open(o){window.location="/book?code="+o}function on_logout(){logout(function(){window.location="/login"})}function on_users(){window.location="/users"}function on_settings(){window.location="/settings"}function on_login(){var o=collect_values_if_possible("username","password");o&&login(o.username,o.password,function(){window.location="/"},function(o){alert(o)})}function on_signin(){var o=collect_values_if_possible("username","password");o&&signin(o.username,o.password,function(){window.location="/"},function(o){alert(o)})}function on_back(){window.location.href="/"}function on_commit(){var o=Object();$(".collectable").map(function(){return o[$(this).attr("id")]=$(this).val(),this}),set_settings(o,function(){window.location.href="/settings"})}function on_modal_take(o){var n=collect_values_if_possible("min_step_input","max_step_input","start_cost_input");n&&((n=assemble_participation(n.min_step_input,n.max_step_input,n.start_cost_input))?take_book(get_params("code"),n,function(){window.location=window.location.href}):alert("Min step should be less than max!"))}function on_modal_delete_user(){signout(function(){window.location="/login"})}function on_money(){money_user($("#money_input").val())}function on_back(){window.location.href="/"}$(document).ready(function(){var o=get_params("filter");o&&$("#"+o).prop("checked",!0)}),$("input[type=radio]").change(function(){window.location="?filter="+$(this).attr("id")}),$("input[type=checkbox]").change(function(){part_user($(this).prop("checked"),$(this).attr("id"))});